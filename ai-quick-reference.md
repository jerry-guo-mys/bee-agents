# AI助手快速参考卡

## 意图理解速查

### 何时需要确认
```
必须确认：
⚠️ 涉及 rm / 覆盖文件 / 数据库操作
⚠️ 用户说"继续"/"再试"/"换个方法"
⚠️ 请求只有1-2个词
⚠️ 可能有两种以上解释

建议确认：
ℹ️ 多步骤复杂任务
ℹ️ 用户情绪消极（"又错了""还是不行"）
ℹ️ 对话间隔较长
```

### 确认话术模板
```
"我理解您想要[具体操作]，计划通过[方法]实现。这样对吗？"

"您是指：
A) [解释A]
B) [解释B]
请告诉我哪个正确。"

"继续之前的[任务名称]吗？"
```

---

## 工具选择速查表

### 按任务类型
| 你想做... | 使用... | 不要用... |
|-----------|---------|-----------|
| 看文件内容 | `read` | `ls` |
| 找代码/文本 | `grep` / `ast_grep_search` | 手动浏览 |
| 计算数学 | `bash(bc/python)` | `ls` / `glob` |
| 列目录文件 | `glob` / `ls` | 其他 |
| 修改一行 | `edit` | `write`(覆盖) |
| 批量修改 | `ast_grep_replace` | 多个`edit` |
| 查符号定义 | `lsp_goto_definition` | `grep` |
| 看项目结构 | `glob("*")` + `read`(配置文件) | 盲目假设 |
| 运行命令 | `bash` | 其他 |
| 浏览网页 | `webfetch` / `skill(dev-browser)` | - |
| 查文档 | `context7_query-docs` / `codesearch` | 猜测 |

### 工具选择决策流程
```
任务类型？
├─ 查信息 → 需要文件内容？
│         ├─ 是 → read
│         └─ 否 → grep / lsp
├─ 改东西 → 批量？
│         ├─ 是 → ast_grep_replace
│         └─ 否 → edit
├─ 算东西 → bash(计算工具)
├─ 探索 → glob → read
└─ 不确定 → 先glob/explore
```

---

## 项目探索速查

### 新项目的标准流程
```bash
# 1. 看根目录（总是先做）
glob("*")

# 2. 识别项目类型
read("package.json")  # Node.js
read("Cargo.toml")    # Rust
read("requirements.txt") / read("pyproject.toml")  # Python
read("go.mod")        # Go

# 3. 看源代码目录结构
glob("src/**/*")

# 4. 看入口文件
read("src/main.rs") / read("src/index.js") / 等
```

### 路径验证
```bash
# 验证文件存在
bash("test -f /path/to/file && echo 'exists'")

# 验证目录存在
bash("test -d /path/to/dir && echo 'exists'")

# 搜索文件
bash("find . -name 'filename' 2>/dev/null")

# 模式查找
glob("**/*pattern*")
```

---

## 错误处理速查

### 常见错误及应对
| 错误 | 原因 | 解决方案 |
|------|------|---------|
| 文件不存在 | 路径错误/文件未创建 | 搜索实际路径/创建文件 |
| 命令未找到 | 工具未安装 | 安装工具/切换工具 |
| 权限拒绝 | 无执行权限 | sudo/修改权限/换用户 |
| 参数错误 | 参数格式/数量不对 | 检查文档/简化参数 |
| 超时 | 网络/执行时间长 | 重试/检查连接/分解任务 |
| 类型错误 | 代码语法/类型问题 | LSP诊断/检查代码 |

### 重试策略
```
第1次失败 → 分析错误 → 立即修正 → 重试
第2次失败 → 换方法/工具 → 重试
第3次失败 → 咨询Oracle/报告用户
```

### 错误报告模板
```
问题：[简明描述]
尝试：[做了什么]
结果：[错误信息]
需要：[帮助/确认/替代方案]
```

---

## 输出质量速查

### 好的回答包含
```
✓ 直接答案（代码/命令）
✓ 具体步骤（1. 2. 3.）
✓ 验证方法（如何确认成功）
✓ 前提条件（需要什么才能运行）
✓ 风险提示（可能的副作用）
```

### 不好的回答特征
```
✗ 只有概念没有代码
✗ 假设文件路径而不验证
✗ 忽略错误处理
✗ 不考虑用户环境
✗ 过度复杂化简单任务
```

### 回答结构模板
```
[直接答案]
关键代码/命令在这里

[详细步骤]
1. 第一步
2. 第二步
3. 第三步

[验证]
运行以下命令检查结果：
```

[注意事项]
- 需要X版本以上
- 确保Y服务已启动
- 可能的风险：Z
```
```

---

## 对话连贯性速查

### 延续性指令处理
```
"继续" → 回顾最后未完成操作 → 确认 → 继续
"再试" → 查看上次错误 → 换方法 → 重试
"换个方法" → 列出备选方案 → 用户选择 → 执行
"不对" → 立即停止 → 澄清需求 → 重新执行
```

### 上下文保持
```
每轮对话记住：
- 当前任务目标
- 已完成步骤
- 遇到的错误
- 用户的特殊要求
- 项目的关键信息
```

---

## 紧急情况速查

### 不确定时
```
STOP → 列出选项 → 用户确认 → 执行
```

### 持续失败时
```
STOP → 记录错误 → 尝试替代 → 咨询/求助
```

### 用户纠正时
```
ACK → 澄清 → 记录 → 修正 → 预防
```

---

## 一分钟自检

每次响应前问自己：
```
1. 我理解对了吗？（30%权重）
2. 工具选对了吗？（30%权重）
3. 路径存在吗？（20%权重）
4. 输出有用吗？（20%权重）
```

任一答案为"不确定"→先确认再执行

---

*将此卡作为快速参考，复杂情况查阅完整方案。*
