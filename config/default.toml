[app]
name = "Bee"
workspace_root = "./workspace"
max_context_turns = 20

[llm]
# 优先级: DEEPSEEK_API_KEY > OPENAI_API_KEY
# DeepSeek: https://api.deepseek.com
# - deepseek-chat: 常规对话，响应快
# - deepseek-reasoner: 思考模式（DeepSeek-R1），适合复杂推理、代码、数学
# OpenAI:   https://api.openai.com/v1, 模型 gpt-4o-mini 等
provider = "deepseek"
model = "deepseek-reasoner"
base_url = "https://api.deepseek.com"

[llm.deepseek]
model = "deepseek-reasoner"
# 可选 deepseek-chat（常规）、deepseek-reasoner（思考/推理，更强）

[llm.openai]
model = "gpt-4o-mini"

[llm.timeouts]
# 单次非流式请求超时（秒）
request = 120
# 流式请求：整体允许的最长时间（复杂推理/多步 ReAct 可能较久）
stream = 600

[tools]
filesystem_root = "./workspace"
tool_timeout_secs = 30

[tools.shell]
allowed_commands = ["ls", "grep", "cat", "head", "tail", "wc", "find", "cargo", "rustc"]

[tools.search]
timeout_secs = 15
max_result_chars = 8000
allowed_domains = [
  "en.wikipedia.org", "zh.wikipedia.org", "ja.wikipedia.org",
  "www.baidu.com", "baike.baidu.com",
  "www.jd.com", "item.jd.com",
  "docs.rs", "github.com", "stackoverflow.com",
  "news.google.com", "developer.mozilla.org", "arxiv.org"
]

[tools.deep_research]
max_rounds = 5
max_results_per_round = 3
trusted_domains = [
  "wikipedia.org", "arxiv.org", "pubmed.gov", "scholar.google.com",
  "github.com", "stackoverflow.com", "docs.rs", "developer.mozilla.org"
]

# 技能插件（白皮书：Agent 动态注册新工具）。每项运行「程序 + 参数模板」，{{workspace}} 替换为沙箱根路径，{{key}} 从 LLM 传入的 args 取 key
# [[tools.plugins]]
# name = "run_script"
# description = "Run a Python script in workspace. Args: query (string)."
# program = "python"
# args = ["{{workspace}}/scripts/run.py", "{{query}}"]

# 长期记忆后端（向量检索：嵌入 API + 内存向量存储，与 FileLongTerm 二选一）
[memory]
# 启用向量长期记忆（调用 OpenAI 兼容 /embeddings）
vector_enabled = false
# 嵌入模型名（如 text-embedding-3-small）
embedding_model = "text-embedding-3-small"
# 嵌入 API 独立 base_url / api_key（未设置时使用 [llm].base_url 与 OPENAI_API_KEY）
# embedding_base_url = "https://api.openai.com/v1"
# embedding_api_key = "sk-..."
# qdrant_url = "http://localhost:6333"

# 自我进化（参见 docs/EVOLUTION.md）
[evolution]
# 当模型调用不存在的工具（HallucinatedTool）时，是否自动向 memory/lessons.md 追加一条教训（默认 true）
auto_lesson_on_hallucination = true
# 是否将工具调用成功也写入 memory/procedural.md（§3.5 工具统计；默认 false 减少噪音）
record_tool_success = false

# 自主迭代核心配置
# 是否启用自主迭代功能
enabled = true
# 单次运行最大迭代次数
max_iterations = 10
# 目标质量分数阈值
target_score_threshold = 0.8
# 是否自动提交 Git
auto_commit = true
# 是否需要人工确认（向后兼容）
require_approval = false
# 重点改进领域
focus_areas = ["performance", "readability", "documentation", "testing"]

# 调度控制
# 调度类型: manual (仅手动), interval (间隔), daily (每日), weekly (每周)
schedule_type = "manual"
# 间隔调度时的秒数 (默认 24 小时)
schedule_interval_seconds = 86400
# 每日/每周调度的具体时间 (HH:MM)
schedule_time = "02:00"
# 每个周期最大迭代次数
max_iterations_per_period = 3
# 失败后的冷却时间（秒）
cooldown_seconds = 300

# 审批控制
# 审批模式: none (无), console (控制台), prompt (提示超时), webhook (Webhook)
approval_mode = "none"
# 等待审批的超时时间（秒）
approval_timeout_seconds = 3600
# Webhook URL（用于外部审批系统）
# approval_webhook_url = "http://example.com/approve"
# 需要审批的操作类型
require_approval_for = ["critical"]

# 安全限制
# 安全级别: strict (严格), balanced (平衡), permissive (宽松)
safe_mode = "strict"
# 允许修改的目录白名单
allowed_directories = ["./src"]
# 禁止修改的关键文件
restricted_files = ["Cargo.toml", "src/main.rs"]
# 单次修改最大文件大小（KB）
max_file_size_kb = 1024
# 允许的操作类型
allowed_operation_types = ["add", "replace"]
# 失败时自动回滚
rollback_enabled = true
# 编辑前创建备份
backup_before_edit = true

# bee-web 服务（端口可由环境变量 BEE_WEB_PORT 覆盖）
[web]
port = 8080

# 心跳机制（仅 bee-web：后台自主循环，思考现状 → 检查待办 → 反思）
[heartbeat]
enabled = false
interval_secs = 300
